/*! For license information please see 365.bundle.cae19ab6e929af29375d.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[365],{68365:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ke}});var n=r(32735),i=r(12788),o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};var c=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},s="object"==typeof l&&l&&l.Object===Object&&l,f="object"==typeof self&&self&&self.Object===Object&&self,p=s||f||Function("return this")(),d=p,v=function(){return d.Date.now()},m=/\s/;var h=function(e){for(var t=e.length;t--&&m.test(e.charAt(t)););return t},y=/^\s+/;var g=function(e){return e?e.slice(0,h(e)+1).replace(y,""):e},w=p.Symbol,b=w,E=Object.prototype,I=E.hasOwnProperty,S=E.toString,O=b?b.toStringTag:void 0;var x=function(e){var t=I.call(e,O),r=e[O];try{e[O]=void 0;var n=!0}catch(e){}var i=S.call(e);return n&&(t?e[O]=r:delete e[O]),i},T=Object.prototype.toString;var A=x,L=function(e){return T.call(e)},D=w?w.toStringTag:void 0;var C=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":D&&D in Object(e)?A(e):L(e)},M=function(e){return null!=e&&"object"==typeof e};var V=g,R=c,N=function(e){return"symbol"==typeof e||M(e)&&"[object Symbol]"==C(e)},_=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,P=/^0o[0-7]+$/i,k=parseInt;var Z=c,H=v,G=function(e){if("number"==typeof e)return e;if(N(e))return NaN;if(R(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=R(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=V(e);var r=j.test(e);return r||P.test(e)?k(e.slice(2),r?2:8):_.test(e)?NaN:+e},U=Math.max,F=Math.min;var W=function(e,t,r){var n,i,o,a,u,l,c=0,s=!1,f=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function d(t){var r=n,o=i;return n=i=void 0,c=t,a=e.apply(o,r)}function v(e){return c=e,u=setTimeout(h,t),s?d(e):a}function m(e){var r=e-l;return void 0===l||r>=t||r<0||f&&e-c>=o}function h(){var e=H();if(m(e))return y(e);u=setTimeout(h,function(e){var r=t-(e-l);return f?F(r,o-(e-c)):r}(e))}function y(e){return u=void 0,p&&n?d(e):(n=i=void 0,a)}function g(){var e=H(),r=m(e);if(n=arguments,i=this,l=e,r){if(void 0===u)return v(l);if(f)return clearTimeout(u),u=setTimeout(h,t),d(l)}return void 0===u&&(u=setTimeout(h,t)),a}return t=G(t)||0,Z(r)&&(s=!!r.leading,o=(f="maxWait"in r)?U(G(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),g.cancel=function(){void 0!==u&&clearTimeout(u),c=0,n=l=i=u=void 0},g.flush=function(){return void 0===u?a:y(H())},g},z=W,B=c;var q=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return B(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),z(e,t,{leading:n,maxWait:t,trailing:i})},K=function(e,t,r,n){switch(t){case"debounce":return W(e,r,n);case"throttle":return q(e,r,n);default:return e}},$=function(e){return"function"==typeof e},Y=function(){return"undefined"==typeof window},J=function(e){return e instanceof Element||e instanceof HTMLDocument},Q=function(e,t,r,n){return function(i){var o=i.width,a=i.height;t((function(t){return t.width===o&&t.height===a||t.width===o&&!n||t.height===a&&!r?t:(e&&$(e)&&e(o,a),{width:o,height:a})}))}},X=function(e){function t(t){var r=e.call(this,t)||this;r.cancelHandler=function(){r.resizeHandler&&r.resizeHandler.cancel&&(r.resizeHandler.cancel(),r.resizeHandler=null)},r.attachObserver=function(){var e=r.props,t=e.targetRef,n=e.observerOptions;if(!Y()){t&&t.current&&(r.targetRef.current=t.current);var i=r.getElement();i&&(r.observableElement&&r.observableElement===i||(r.observableElement=i,r.resizeObserver.observe(i,n)))}},r.getElement=function(){var e=r.props,t=e.querySelector,n=e.targetDomEl;if(Y())return null;if(t)return document.querySelector(t);if(n&&J(n))return n;if(r.targetRef&&J(r.targetRef.current))return r.targetRef.current;var o=(0,i.findDOMNode)(r);if(!o)return null;switch(r.getRenderType()){case"renderProp":case"childFunction":case"child":case"childArray":return o;default:return o.parentElement}},r.createResizeHandler=function(e){var t=r.props,n=t.handleWidth,i=void 0===n||n,o=t.handleHeight,a=void 0===o||o,u=t.onResize;if(i||a){var l=Q(u,r.setState.bind(r),i,a);e.forEach((function(e){var t=e&&e.contentRect||{},n=t.width,i=t.height;!r.skipOnMount&&!Y()&&l({width:n,height:i}),r.skipOnMount=!1}))}},r.getRenderType=function(){var e=r.props,t=e.render,i=e.children;return $(t)?"renderProp":$(i)?"childFunction":(0,n.isValidElement)(i)?"child":Array.isArray(i)?"childArray":"parent"};var o=t.skipOnMount,a=t.refreshMode,u=t.refreshRate,l=void 0===u?1e3:u,c=t.refreshOptions;return r.state={width:void 0,height:void 0},r.skipOnMount=o,r.targetRef=(0,n.createRef)(),r.observableElement=null,Y()||(r.resizeHandler=K(r.createResizeHandler,a,l,c),r.resizeObserver=new window.ResizeObserver(r.resizeHandler)),r}return a(t,e),t.prototype.componentDidMount=function(){this.attachObserver()},t.prototype.componentDidUpdate=function(){this.attachObserver()},t.prototype.componentWillUnmount=function(){Y()||(this.resizeObserver.disconnect(),this.cancelHandler())},t.prototype.render=function(){var e,t=this.props,r=t.render,i=t.children,o=t.nodeType,a=void 0===o?"div":o,l=this.state,c={width:l.width,height:l.height,targetRef:this.targetRef};switch(this.getRenderType()){case"renderProp":return r&&r(c);case"childFunction":return(e=i)(c);case"child":if((e=i).type&&"string"==typeof e.type){var s=u(c,["targetRef"]);return(0,n.cloneElement)(e,s)}return(0,n.cloneElement)(e,c);case"childArray":return(e=i).map((function(e){return!!e&&(0,n.cloneElement)(e,c)}));default:return n.createElement(a,null)}},t}(n.PureComponent);Y()?n.useEffect:n.useLayoutEffect;var ee=r(60216),te=r.n(ee),re=r(81668),ne=r(97135),ie=r(573),oe=r(9521),ae=r(47429),ue=r(2939),le=r(60023),ce=r(25921),se=r(21922),fe=r(14437),pe=r(14439),de=r(67013);function ve(e){var t=e.viewportData,r=e.viewportIndex,i=e.element,o=e.imageSliceData,a=e.setImageSliceData,u=e.scrollbarHeight,l=e.servicesManager.services,c=l.CineService,s=l.CornerstoneViewportService;return(0,n.useEffect)((function(){if(t){var e=s.getCornerstoneViewportByIndex(r);if(e)if(t.viewportType!==pe.Z.STACK){if(t.viewportType===pe.Z.ORTHOGRAPHIC){var n=fe.Z(e);if(!n)return;var i=n.imageIndex,o=n.numberOfSlices;a({imageIndex:i,numberOfSlices:o})}}else{var u=e.getCurrentImageIdIndex();a({imageIndex:u,numberOfSlices:t.data.imageIds.length})}}}),[r,t]),(0,n.useEffect)((function(){if((null==t?void 0:t.viewportType)===pe.Z.STACK){var e=function(e){var r=e.detail.newImageIdIndex;a({imageIndex:r,numberOfSlices:t.data.imageIds.length})};return i.addEventListener(le.Z.STACK_VIEWPORT_SCROLL,e),function(){i.removeEventListener(le.Z.STACK_VIEWPORT_SCROLL,e)}}}),[t,i]),(0,n.useEffect)((function(){if((null==t?void 0:t.viewportType)===pe.Z.ORTHOGRAPHIC){var e=function(e){var t=e.detail,r=t.imageIndex,n=t.numberOfSlices;a({imageIndex:r,numberOfSlices:n})};return i.addEventListener(le.Z.VOLUME_NEW_IMAGE,e),function(){i.removeEventListener(le.Z.VOLUME_NEW_IMAGE,e)}}}),[t,i]),n.createElement(de.Ln,{onChange:function(e){return function(e,t){var r=s.getViewportInfoByIndex(t).getViewportId(),n=s.getCornerstoneViewport(r);c.getState().isCineEnabled&&(c.stopClip(i),c.setCine({id:t,isPlaying:!1})),re.Z(n.element,{imageIndex:e,debounceLoading:!0})}(e,r)},max:o.numberOfSlices?o.numberOfSlices-1:0,height:u,value:o.imageIndex})}ve.propTypes={viewportData:te().object,viewportIndex:te().number.isRequired,element:te().instanceOf(Element),scrollbarHeight:te().string,imageSliceData:te().object.isRequired,setImageSliceData:te().func.isRequired};var me=ve,he=r(6807),ye=r(56918),ge=r(28397);function we(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return be(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ee=1e-4;function Ie(e){var t=e.element,r=e.viewportData,i=e.imageSliceData,o=e.viewportIndex,a=e.servicesManager.services,u=a.CornerstoneViewportService,l=a.ToolBarService,c=we((0,n.useState)({windowCenter:null,windowWidth:null}),2),s=c[0],f=c[1],p=we((0,n.useState)(1),2),d=p[0],v=p[1],m=we((0,n.useState)([]),2),h=m[0],y=m[1];(0,n.useEffect)((function(){y(l.getActiveTools())}),[]),(0,n.useEffect)((function(){var e=!0,t=l.subscribe(l.EVENTS.TOOL_BAR_STATE_MODIFIED,(function(){e&&y(l.getActiveTools())})).unsubscribe;return function(){e=!1,t()}}),[]),(0,n.useEffect)((function(){var e=function(e){var t=e.detail.range;if(t){var r=t.lower,n=t.upper,i=ge.toWindowLevel(r,n),o=i.windowWidth,a=i.windowCenter;f({windowCenter:a,windowWidth:o})}};return t.addEventListener(le.Z.VOI_MODIFIED,e),function(){t.removeEventListener(le.Z.VOI_MODIFIED,e)}}),[o,r,s,t]),(0,n.useEffect)((function(){var e=function(e){var r=e.detail,n=r.previousCamera,i=r.camera;if(n.parallelScale!==i.parallelScale||n.scale!==i.scale){var a=u.getCornerstoneViewportByIndex(o);if(!a)return;var l=a.getImageData();if(!l)return;if(i.scale)return void v(i.scale);var c=l.spacing,s=t.clientHeight*c[0]*.5/i.parallelScale;v(s)}};return t.addEventListener(le.Z.CAMERA_MODIFIED,e),function(){t.removeEventListener(le.Z.CAMERA_MODIFIED,e)}}),[o,r]);var g=(0,n.useCallback)((function(){var e=s.windowWidth,t=s.windowCenter;return h.includes("WindowLevel")?"number"!=typeof t||"number"!=typeof e?null:n.createElement("div",{className:"flex flex-row"},n.createElement("span",{className:"mr-1"},"W:"),n.createElement("span",{className:"ml-1 mr-2 font-light"},e.toFixed(0)),n.createElement("span",{className:"mr-1"},"L:"),n.createElement("span",{className:"ml-1 font-light"},t.toFixed(0))):h.includes("Zoom")?n.createElement("div",{className:"flex flex-row"},n.createElement("span",{className:"mr-1"},"Zoom:"),n.createElement("span",{className:"font-light"},d.toFixed(2),"x")):null}),[s,d,h]),w=(0,n.useCallback)((function(){var e=i.imageIndex,t=i.numberOfSlices;if(r){var a;if(r.viewportType===pe.Z.STACK){if(a=function(e,t){var r=e.data.imageIds,n=r[t];if(!n)return;var i=(ye.get("generalImageModule",n)||{}).instanceNumber;if(r.length<=1)return;return parseInt(i)}(r,e),!a)return null}else r.viewportType===pe.Z.ORTHOGRAPHIC&&(a=function(e,t,r,n){var i=e.data.map((function(e){return e.volume}));if(!i||i.length>1)return;var o=i[0],a=o.direction,u=o.imageIds,l=n.getCornerstoneViewportByIndex(r);if(!l)return;var c=l.getCamera().viewPlaneNormal,s=a.slice(6,9),f=he.cross(he.create(),c,s);if(he.length(f)<Ee){var p=u[t];if(!p)return{};var d=(ye.get("generalImageModule",p)||{}).instanceNumber;return parseInt(d)}}(r,e,o,u));return n.createElement("div",{className:"flex flex-row"},n.createElement("span",{className:"mr-1"},"I:"),n.createElement("span",{className:"font-light"},void 0!==a?"".concat(a," (").concat(e+1,"/").concat(t,")"):"".concat(e+1,"/").concat(t)))}}),[i,r,o]);return r?n.createElement(de.No,{topLeft:g(),topRight:w()}):null}Ie.propTypes={viewportData:te().object,imageIndex:te().number,viewportIndex:te().number};var Se=Ie;function Oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Te=r(97617),Ae=Te.getOrientationStringLPS,Le=Te.invertOrientationStringLPS;function De(e){var t=e.element,r=e.viewportData,i=e.imageSliceData,o=e.viewportIndex,a=e.servicesManager,u=e.orientationMarkers,l=void 0===u?["top","left"]:u,c=Oe((0,n.useState)(0),2),s=c[0],f=c[1],p=Oe((0,n.useState)(!1),2),d=p[0],v=p[1],m=Oe((0,n.useState)(!1),2),h=m[0],y=m[1],g=a.services.CornerstoneViewportService;(0,n.useEffect)((function(){var e=function(e){var t=e.detail,r=t.rotation,n=t.previousCamera,i=t.camera;void 0!==r&&f(r),void 0!==i.flipHorizontal&&n.flipHorizontal!==i.flipHorizontal&&v(i.flipHorizontal),void 0!==i.flipVertical&&n.flipVertical!==i.flipVertical&&y(i.flipVertical)};return t.addEventListener(le.Z.CAMERA_MODIFIED,e),function(){t.removeEventListener(le.Z.CAMERA_MODIFIED,e)}}),[]);var w=(0,n.useMemo)((function(){if(!r)return"";var e,a;if("stack"===r.viewportType){var u,c=i.imageIndex,f=null===(u=r.data.imageIds)||void 0===u?void 0:u[c];if(!f)return!1;var p=ye.get("imagePlaneModule",f)||{};e=p.rowCosines,a=p.columnCosines}else{if(!t||!(0,oe.ZP)(t))return"";var v=(0,oe.ZP)(t).viewport.getCamera(),m=v.viewUp,y=v.viewPlaneNormal,w=he.create();he.cross(w,m,y),a=[-m[0],-m[1],-m[2]],e=w}if(!e||!a||void 0===s)return"";var b=function(e,t,r,n,i){var o=Ae(e),a=Ae(t),u=Le(o),l={top:Le(a),left:u,right:o,bottom:a};n&&(l.top=Le(l.top),l.bottom=Le(l.bottom));i&&(l.left=Le(l.left),l.right=Le(l.right));if(90===r||-270===r)return{top:l.left,left:Le(l.top),right:Le(l.bottom),bottom:l.right};if(-90===r||270===r)return{top:Le(l.left),left:l.top,bottom:l.left,right:l.bottom};if(180===r||-180===r)return{top:Le(l.top),left:Le(l.left),bottom:Le(l.bottom),right:Le(l.right)};return l}(e,a,s,h,d),E=g.getViewportInfoByIndex(o).getViewportOptions().background;!!E&&ue.Z(E,[1,1,1]);return l.map((function(e,t){return n.createElement("div",{className:"".concat(e,"-mid orientation-marker"),key:"".concat(e,"-mid orientation-marker")},n.createElement("div",{className:"orientation-marker-value"},b[e]))}))}),[r,i,s,h,d,l,t]);return n.createElement("div",{className:"ViewportOrientationMarkers noselect"},w)}De.propTypes={percentComplete:te().number,error:te().object},De.defaultProps={percentComplete:0,error:null};var Ce=De;function Me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ve(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Re(e){var t=e.viewportData,r=e.element,i=Me((0,n.useState)(!1),2),o=i[0],a=i[1],u=Me((0,n.useState)(!1),2),l=u[0],c=u[1],s=(0,n.useRef)(null),f=(0,n.useRef)(null),p=function(e){clearTimeout(s.current),s.current=setTimeout((function(){a(!0)}),50)},d=function(e){clearTimeout(s.current),a(!1)},v=function(e){clearTimeout(s.current),f.current===e.detail.imageId&&(c(e.detail.error),f.current=null)};return(0,n.useEffect)((function(){return r.addEventListener(le.Z.STACK_VIEWPORT_SCROLL,p),r.addEventListener(le.Z.IMAGE_LOAD_ERROR,v),r.addEventListener(le.Z.STACK_NEW_IMAGE,d),function(){r.removeEventListener(le.Z.STACK_VIEWPORT_SCROLL,p),r.removeEventListener(le.Z.STACK_NEW_IMAGE,d),r.removeEventListener(le.Z.IMAGE_LOAD_ERROR,v)}}),[r,t]),l?n.createElement(n.Fragment,null,n.createElement("div",{className:"bg-black opacity-50 absolute h-full w-full top-0 left-0"},n.createElement("div",{className:"flex transparent items-center justify-center w-full h-full"},n.createElement("p",{className:"text-primary-light text-xl font-light"},n.createElement("h4",null,"Error Loading Image"),n.createElement("p",null,"An error has occurred."),n.createElement("p",null,l))))):o?n.createElement("div",{className:"pointer-events-none bg-black opacity-50 absolute h-full w-full top-0 left-0"},n.createElement("div",{className:"flex transparent items-center justify-center w-full h-full"},n.createElement("p",{className:"text-primary-light text-xl font-light"},"Loading..."))):null}Re.propTypes={percentComplete:te().number,error:te().object,element:te().object},Re.defaultProps={percentComplete:0,error:null};var Ne=Re;function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Pe=function(e){var t=e.viewportIndex,r=e.element,i=e.scrollbarHeight,o=e.servicesManager,a=e.disableViewportImageScrollbar,u=e.disableViewportOverlay,l=e.disableViewportImageSliceLoadingIndicator,c=e.disableViewportOrientationMarkers,s=o.services,f=s.CornerstoneViewportService,p=(s.CornerstoneCacheService,_e((0,n.useState)({imageIndex:0,numberOfSlices:0}),2)),d=p[0],v=p[1],m=_e((0,n.useState)(null),2),h=m[0],y=m[1];if((0,n.useEffect)((function(){var e=f.subscribe(f.EVENTS.VIEWPORT_DATA_CHANGED,(function(e){e.viewportIndex===t&&y(e.viewportData)})),r=e.unsubscribe;return function(){r()}}),[t]),!r)return null;if(h){var g,w,b=f.getViewportInfoByIndex(t);if(null!=b&&null!==(g=b.viewportOptions)&&void 0!==g&&null!==(w=g.customViewportProps)&&void 0!==w&&w.hideOverlays)return null}return n.createElement("div",{className:"noselect"},!a&&n.createElement(me,{viewportIndex:t,viewportData:h,element:r,imageSliceData:d,setImageSliceData:v,scrollbarHeight:i,servicesManager:o}),!u&&n.createElement(Se,{imageSliceData:d,viewportData:h,viewportIndex:t,servicesManager:o,element:r}),!l&&n.createElement(Ne,{viewportData:h,element:r}),!c&&n.createElement(Ce,{imageSliceData:d,element:r,viewportData:h,servicesManager:o,viewportIndex:t}))},ke=r(63130);function Ze(){Ze=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new S(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=b(a,r);if(u){if(u===s)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===s)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var s={};function f(){}function p(){}function d(){}var v={};u(v,i,(function(){return this}));var m=Object.getPrototypeOf,h=m&&m(m(O([])));h&&h!==t&&r.call(h,i)&&(v=h);var y=d.prototype=f.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,a,u){var l=c(e[i],e,o);if("throw"!==l.type){var s=l.arg,f=s.value;return f&&"object"==We(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,a,u)}),(function(e){n("throw",e,a,u)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,u)}))}u(l.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function O(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return p.prototype=d,u(y,"constructor",d),u(d,"constructor",p),p.displayName=u(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(w.prototype),u(w.prototype,o,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new w(l(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),u(y,a,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;I(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:O(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}function He(e,t,r,n,i,o,a){try{var u=e[o](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Ge(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){He(o,n,i,a,u,"next",e)}function u(e){He(o,n,i,a,u,"throw",e)}a(void 0)}))}}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(e){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},We(e)}function ze(e,t){if(t.needsRerendering)return!1;if(e.displaySets.length!==t.displaySets.length)return!1;if(e.viewportOptions.orientation!==t.viewportOptions.orientation)return!1;if(e.viewportOptions.viewportType!==t.viewportOptions.viewportType)return!1;var r=e.displaySets,n=t.displaySets;if(r.length!==n.length)return!1;for(var i=function(e){var t,i,o,a=r[e],u=n.find((function(e){return e.displaySetInstanceUID===a.displaySetInstanceUID}));if(!u)return{v:!1};if((null===(t=u.images)||void 0===t?void 0:t.length)!==(null===(i=a.images)||void 0===i?void 0:i.length))return{v:!1};if(null!==(o=u.images)&&void 0!==o&&o.length)for(var l=0;l<u.images.length;l++)if(u.images[l].imageId!==a.images[l].imageId)return{v:!1}},o=0;o<r.length;o++){var a=i(o);if("object"===We(a))return a.v}return!0}var Be=n.memo(n.forwardRef((function(e,t){var r=e.viewportIndex,i=e.displaySets,o=e.dataSource,a=e.viewportOptions,u=e.displaySetOptions,l=e.servicesManager,c=e.onElementEnabled,s=e.onElementDisabled,f=e.initialImageIndex,p=e.disableViewportImageScrollbar,d=e.disableViewportOverlay,v=e.disableViewportImageSliceLoadingIndicator,m=e.disableViewportOrientationMarkers,h=Ue((0,n.useState)("100px"),2),y=h[0],g=h[1],w=(0,n.useRef)();n.useImperativeHandle(t,(function(){return w.current}));var b=l.services,E=b.MeasurementService,I=b.DisplaySetService,S=b.ToolBarService,O=b.ToolGroupService,x=b.SyncGroupService,T=b.CornerstoneViewportService,A=b.CornerstoneCacheService,L=b.ViewportGridService,D=(0,n.useCallback)((function(){var e="".concat(w.current.clientHeight-20,"px");g(e)}),[w]),C=(0,n.useCallback)((function(){w.current&&(T.resize(),D())}),[w]),M=(0,n.useCallback)((function(e){if(e.detail.element===w.current){var t=e.detail,r=t.viewportId,n=t.element,i=T.getViewportInfo(r),o=i.getViewportIndex();(0,se.Yc)(o,n);var a=i.getRenderingEngineId(),u=i.getToolGroupId(),l=i.getSyncGroups();O.addViewportToToolGroup(r,a,u),x.addViewportToSyncGroup(r,a,l),c&&c(e)}}),[r,c,O]);return(0,n.useEffect)((function(){return T.enableViewport(r,a,w.current),ie.Z.addEventListener(le.Z.ELEMENT_ENABLED,M),D(),function(){var e=T.getViewportInfoByIndex(r),t=e.getViewportId(),n=e.getRenderingEngineId(),i=e.getSyncGroups();O.removeViewportFromToolGroup(t,n),x.removeViewportFromSyncGroup(t,n,i),T.disableElement(r),s&&s(e),ie.Z.removeEventListener(le.Z.ELEMENT_ENABLED,M)}}),[]),(0,n.useEffect)((function(){var e=I.subscribe(I.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,function(){var e=Ge(Ze().mark((function e(t){var n,i,a;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=T.getViewportInfoByIndex(r)).hasDisplaySet(t)){e.next=8;break}return i=n.getViewportData(),e.next=5,A.invalidateViewportData(i,t,o,I);case 5:a=e.sent,!0,T.updateViewport(r,a,true);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t=e.unsubscribe;return function(){t()}}),[r]),(0,n.useEffect)((function(){a.viewportType||(a.viewportType="stack");var e=function(){var e=Ge(Ze().mark((function e(){var t;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.createViewportData(i,a,o,f);case 2:t=e.sent,T.setViewportData(r,t,a,u);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[a,i,o]),(0,n.useEffect)((function(){var e=function(e,t,r,n,i,o,a){var u=i.map((function(e){return e.displaySetInstanceUID}));return e.subscribe(e.EVENTS.JUMP_TO_MEASUREMENT,(function(i){var l=i.measurement;l&&u.includes(l.displaySetInstanceUID)&&qe(l,r,n,e,t,o,a)})).unsubscribe}(E,I,w,r,i,L,T);return function(e,t,r,n,i,o,a){var u=i.map((function(e){return e.displaySetInstanceUID})),l=e.getJumpToMeasurement(n);if(l&&r){var c=e.getMeasurement(l);u.includes(c.displaySetInstanceUID)&&qe(c,r,n,e,t,o,a)}}(E,I,w,r,i,L,T),function(){e()}}),[i,w,r]),n.createElement("div",{className:"viewport-wrapper"},n.createElement(X,{handleWidth:!0,handleHeight:!0,skipOnMount:!0,refreshMode:"throttle",refreshRate:100,onResize:C,targetRef:w.current}),n.createElement("div",{className:"cornerstone-viewport-element",style:{height:"100%",width:"100%"},onContextMenu:function(e){return e.preventDefault()},onMouseDown:function(e){return e.preventDefault()},ref:w}),n.createElement(Pe,{disableViewportImageScrollbar:p,disableViewportOverlay:d,disableViewportImageSliceLoadingIndicator:v,disableViewportOrientationMarkers:m,viewportIndex:r,ToolBarService:S,element:w.current,scrollbarHeight:y,servicesManager:l}))})),ze);function qe(e,t,r,n,i,o,a){var u=t.current,l=e.displaySetInstanceUID,c=e.SOPInstanceUID,s=e.frameNumber;c||console.warn("cannot jump in a non-acquisition plane measurements yet");var f=i.getDisplaySetByUID(l);o.setActiveViewportIndex(r);var p=(0,oe.ZP)(u),d=a.getViewportInfoByIndex(r);if(p){var v=p.viewport,m=0,h=!0;if(v instanceof ae.Z){m=v.getImageIds().findIndex((function(e){var t=(0,ke.Z)(e),r=t.SOPInstanceUID,n=t.frameNumber;return r===c&&(!s||s===n)}))}else{var y,g=e.metadata.viewPlaneNormal;m=f.images.findIndex((function(e){return e.SOPInstanceUID===c}));var w=d.getViewportOptions().orientation;w&&g&&!ue.Z(null===(y=ce.Z[w])||void 0===y?void 0:y.viewPlaneNormal,g)&&(h=!1)}if(!h||-1===m)return;re.Z(u,{imageIndex:m}),ne.setAnnotationSelected(e.uid),n.removeJumpToMeasurement(r)}}Be.displayName="OHIFCornerstoneViewport",Be.propTypes={viewportIndex:te().number.isRequired,displaySets:te().array.isRequired,dataSource:te().object.isRequired,viewportOptions:te().object,displaySetOptions:te().arrayOf(te().any),servicesManager:te().object.isRequired,onElementEnabled:te().func,initialImageIdOrIndex:te().oneOfType([te().string,te().number])};var Ke=Be}}]);
//# sourceMappingURL=365.bundle.cae19ab6e929af29375d.js.map