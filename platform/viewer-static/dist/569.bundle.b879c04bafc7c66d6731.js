"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[569],{33569:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var s=n(60216),i=n.n(s),a=n(32735),o=n(38942),r=n(78579),l=n(84334),c=n(12494);const u=function(e,t,n){const s=n.getModuleEntry("@ohif/extension-cornerstone.utilityModule.tools"),{toolNames:i,Enums:a}=s.exports,o={active:[{toolName:i.WindowLevel,bindings:[{mouseButton:a.MouseBindings.Primary}]},{toolName:i.Pan,bindings:[{mouseButton:a.MouseBindings.Auxiliary}]},{toolName:i.Zoom,bindings:[{mouseButton:a.MouseBindings.Secondary}]},{toolName:i.StackScrollMouseWheel,bindings:[]}],enabled:[{toolName:i.SegmentationDisplay}]};return e.createToolGroupAndAddTools(t,o,{})};const p=async function(e){let{segDisplaySet:t,viewportIndex:n,servicesManager:s}=e;const{segmentationService:i,hangingProtocolService:a,viewportGridService:o}=s.services,r=t.referencedDisplaySetInstanceUID;let l=null;l=await i.createSegmentationForSEGDisplaySet(t,l,!1),i.hydrateSegmentation(t.displaySetInstanceUID);const{viewports:c}=o.getState(),u=a.getViewportsRequireUpdate(n,r);return o.setDisplaySetsForViewports(u),c.forEach(((e,s)=>{if(s===n)return;i.shouldRenderSegmentation(e.displaySetInstanceUIDs,t.displaySetInstanceUID)&&o.setDisplaySetsForViewport({viewportIndex:s,displaySetInstanceUIDs:e.displaySetInstanceUIDs,viewportOptions:{initialImageOptions:{preset:"middle"}}})})),!0},m={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const d=function(e){let{servicesManager:t,segDisplaySet:n,viewportIndex:s}=e;const{uiViewportDialogService:i}=t.services;return new Promise((async function(e,a){const o=await function(e,t){return new Promise((function(n,s){const i="Do you want to open this Segmentation?",a=[{type:"secondary",text:"No",value:m.CANCEL},{type:"primary",text:"Yes",value:m.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportIndex:t,type:"info",message:i,actions:a,onSubmit:o,onOutsideClick:()=>{e.hide(),n(m.CANCEL)}})}))}(i,s);if(o===m.HYDRATE_SEG){e(await p({segDisplaySet:n,viewportIndex:s,servicesManager:t}))}}))};function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},S.apply(this,arguments)}const{formatDate:g}=r.ZP,E="SEGToolGroup";function y(e){const{children:t,displaySets:n,viewportOptions:s,viewportIndex:i,viewportLabel:r,servicesManager:m,extensionManager:y}=e,{t:v}=(0,o.$G)("SEGViewport"),{displaySetService:w,toolGroupService:f,segmentationService:I,uiNotificationService:D}=m.services,b=`${E}-${i}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const h=n[0],[x,N]=(0,c.O_)(),[T,P]=(0,c.en)(),[A,M]=(0,a.useState)(!1),[k,C]=(0,a.useState)(1),[G,O]=(0,a.useState)(h.isHydrated),[U,R]=(0,a.useState)(!h.isLoaded),[L,_]=(0,a.useState)(null),[V,B]=(0,a.useState)({segmentIndex:1,totalSegments:null}),F=(0,a.useRef)(null),{viewports:$,activeViewportIndex:j}=x,H=h.getReferenceDisplaySet(),Y=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(H);F.current={displaySet:H,metadata:Y};const Z=e=>{_(e.detail.element)},q=()=>{_(null)},J=(0,a.useCallback)((()=>{const{component:t}=y.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=F.current;return a.createElement(t,S({},e,{displaySets:[n,h],viewportOptions:{viewportType:"volume",toolGroupId:b,orientation:s.orientation,viewportId:s.viewportId},onElementEnabled:Z,onElementDisabled:q}))}),[i,h,b]),W=(0,a.useCallback)((e=>{e="left"===e?-1:1;const t=h.displaySetInstanceUID,n=I.getSegmentation(t),{segments:s}=n,i=Object.keys(s).length;let a=k+e;a>i-1?a=1:0===a&&(a=i-1),I.jumpToSegmentCenter(t,a,b),C(a)}),[k]);(0,a.useEffect)((()=>{U||d({servicesManager:m,viewportIndex:i,segDisplaySet:h}).then((e=>{e&&O(!0)}))}),[m,i,h,U]),(0,a.useEffect)((()=>{const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENTATION_PIXEL_DATA_CREATED,(e=>{e.segDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&R(!1),e.overlappingSegments&&D.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[h]),(0,a.useEffect)((()=>{const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENT_PIXEL_DATA_CREATED,(e=>{let{segmentIndex:t,numSegments:n}=e;B({segmentIndex:t,totalSegments:n})}));return()=>{e()}}),[h]),(0,a.useEffect)((()=>{const e=w.subscribe(w.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=$[j];t.includes(n.displaySetInstanceUID)&&N.setDisplaySetsForViewport({viewportIndex:j,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,a.useEffect)((()=>{let e=f.getToolGroup(b);if(!e)return e=u(f,b,y),M(!0),()=>{I.removeSegmentationRepresentationFromToolGroup(b),f.destroyToolGroup(b)}}),[]),(0,a.useEffect)((()=>(O(h.isHydrated),()=>{I.removeSegmentationRepresentationFromToolGroup(b),F.current=null})),[h]);let X=null;if(!F.current||H.displaySetInstanceUID!==F.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(X=t.map(((e,t)=>e&&a.cloneElement(e,{viewportIndex:i,key:t}))));const{PatientID:z,PatientName:K,PatientSex:Q,PatientAge:ee,SliceThickness:te,ManufacturerModelName:ne,StudyDate:se,SeriesDescription:ie,SpacingBetweenSlices:ae}=F.current.metadata,oe=async()=>{const e=await p({segDisplaySet:h,viewportIndex:i,servicesManager:m});O(e)};return a.createElement(a.Fragment,null,a.createElement(c.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:W,getStatusComponent:()=>function(e){let{isHydrated:t,onStatusClick:n}=e,s=null,i=null;const{t:r}=(0,o.$G)("Common"),l=r("LOAD");switch(t){case!0:i=()=>a.createElement(c.JO,{name:"status-alert"}),s=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:i=()=>a.createElement(c.JO,{name:"status-untracked"}),s=()=>a.createElement("div",null,"Click LOAD to load segmentation.")}const u=()=>a.createElement("div",{className:"flex h-6 leading-6 cursor-default text-sm text-white"},a.createElement("div",{className:"min-w-[45px] flex items-center p-1 rounded-l-xl rounded-r bg-customgray-100"},a.createElement(i,null),a.createElement("span",{className:"ml-1"},"SEG")),!t&&a.createElement("div",{className:"ml-1 px-1.5 rounded cursor-pointer hover:text-black bg-primary-main hover:bg-primary-light",onMouseUp:n},l));return a.createElement(a.Fragment,null,s&&a.createElement(c.u,{content:a.createElement(s,null),position:"bottom-left"},a.createElement(u,null)),!s&&a.createElement(u,null))}({isHydrated:G,onStatusClick:oe}),studyData:{label:r,useAltStyling:!0,studyDate:g(se),seriesDescription:`SEG Viewport ${ie}`,patientInformation:{patientName:K?l.ZP.utils.formatPN(K.Alphabetic):"",patientSex:Q||"",patientAge:ee||"",MRN:z||"",thickness:te?`${te.toFixed(2)}mm`:"",spacing:void 0!==ae?`${ae.toFixed(2)}mm`:"",scanner:ne||""}}}),a.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},U&&a.createElement(c.LE,{className:"w-full h-full",progress:null!==V.totalSegments?(V.segmentIndex+1)/V.totalSegments*100:null,textBlock:V.totalSegments?a.createElement("span",{className:"text-white text-sm flex items-baseline space-x-2"},a.createElement("div",null,"Loading Segment"),a.createElement("div",{className:"w-3"},`${V.segmentIndex}`),a.createElement("div",null,"/"),a.createElement("div",null,`${V.totalSegments}`)):a.createElement("span",{className:"text-white text-sm"},"Loading SEG ...")}),J(),a.createElement("div",{className:"absolute w-full"},T.viewportIndex===i&&a.createElement(c.P_,{id:"viewport-notification",message:T.message,type:T.type,actions:T.actions,onSubmit:T.onSubmit,onOutsideClick:T.onOutsideClick})),X))}y.propTypes={displaySets:i().arrayOf(i().object),viewportIndex:i().number.isRequired,dataSource:i().object,children:i().node,customProps:i().object},y.defaultProps={customProps:{}};const v=y}}]);